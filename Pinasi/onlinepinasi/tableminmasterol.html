<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="table.css">
    <title></title>
    <style>
.dropset
{
  display: none;
  position: fixed;
  background-color: #f1f1f1;
  min-width: 160px;
  overflow: auto;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  z-index: 1;
  margin-left: 20%;
}

.dropset a {
  color: black;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
}

.dropset a:hover {background-color: #ddd;}
.show {display: block;}
.dropseting{
  width: 5%;
    height: 100%;
    background-color: #ccc;
    margin-top: 0px;
    border: 0px solid ;
    align-items: center;
    margin-left: 5px;
    border-radius: 5px ;
    min-width: 40px;
    display: none;
justify-content: center;
cursor: pointer;
font-size: larger;
}
    </style>
    <div id="set" style="z-index: 100;"  >
      
    
        <button id="setfr" onclick="divover();"></button>
        <button id="refresh" onclick="refresh();" hidden>&#8635;</button>
        <button id="setting"  hidden><div id="leftchev"></div></button>
        <button id="search" hidden><div id="rightchev"></div></button>
        <button onclick="dropsett()" id="drpbtn"  class="dropseting" hidden>&#9881;</button>
        <input type="color" id="hglcolor" value="#DFD77C" hidden>
        <label   id="slid" class="switch">
          <input hidden id="slid1" type="checkbox">
          <span hidden id ="slid2"class="slider round"></span>
        </label>
        <input type="text" id="searcttxt" onkeyup="tablesrch();"  hidden> 
        
        </div><br>
        
        <button id="setcl" onclick="divout();" hidden></button>
        <div id="setdrop" class="dropset">
               
          <input type="checkbox" id="scrc" name="scrc" value="scrc">
          <label for="scrc">Scroll Cell</label>
          <br>
          <input type="checkbox" id="cwb" name="cwb" value="cwb">
          <label for="cwb">Cell Fit</label>
          <br>
          <input type="checkbox" id="hglins" name="hglins" value="hglins">
          <label for="hglins">Mark Inside</label>
        </div>
</head>
    
<body style="height: 95%;" onload="ru();">
        
        <script src="jquery/jquery.min.js"></script>
       
        <script src="math.js"></script>
<script>
 const testFolder = sessionStorage.getItem("project");
 var stbl=sessionStorage.getItem("tablemintype").replace('tablemin.html','');
    function dltnum(data,no){
   


   $.ajax({
   url: 'onhg.php',
   type: 'post',
   data: data,
   processData: false,
   contentType: false,
   success: function(response){
   
   
   
   },error: function (request, status, error) {
   
       
   fetch('http://localhost:3000/deletear', {
   method: 'POST',
   body: JSON.stringify({nume:no}) ,
   headers: { 'Content-Type': 'application/json' }
   })
   .then()
   .then()
   .catch(err => console.log(err)) ;
   
   }
   });  
 
   }       
  
   //
   
   //
           var l =[];
           var minid=[];
           var foot=true;
           var k=[];
           const pageSize = 10;
           var idrow=false;
           var curPage = 1;
           var pagi=document.getElementById('slid1');
           var nextPage=document.getElementById('search');
  var prevPage=document.getElementById('setting');
  
  var scrolldiv =false;
       var cfit =false;
       var fst=false;
       var colhgl = "rgb(223,215,124)";
       var scrc=document.getElementById('scrc');
       var cwb=document.getElementById('cwb');
       var hglins=document.getElementById('hglins');
       var hglcolor =document.getElementById('hglcolor');
  
       function next(){nextPage.click();}
       function prev(){prevPage.click();}
       function page(){pagi.checked=true;idrow=true;}
       function scd(){scrolldiv=true;cwb.disabled=true;if(pagi.checked==true){fst=true;}pagi.checked=false;idrow=false; srefc();}
function scdnorm(){scrolldiv=false;cwb.disabled=false;if(pagi.checked==true){fst=true;}pagi.checked=false;idrow=false;srefc();}
function celfit(){cfit=true;scrc.disabled=true;if(pagi.checked==true){fst=true;}pagi.checked=false;idrow=false;srefc();}
function celfitnorm(){cfit=false;scrc.disabled=false;if(pagi.checked==true){fst=true;}pagi.checked=false;idrow=false;srefc();}
       function hglcol(val){colhgl=val;}

  function norm(){src();pagi.checked=false;idrow=false;idrow=false;}
function pagbt(){pagination();pagi.checked=true;idrow=true;}
 ///
 scrc.addEventListener('change', function() {
  if(scrc.checked==true){scd();}
else{scdnorm();}});   
cwb.addEventListener('change', function() {
  if(cwb.checked==true){celfit();}
else{celfitnorm();}}); 

 ///
 var sjs=document.createElement('script');
 sjs.src="tmath.js";
document.head.appendChild(sjs);
var sjs2=document.createElement('script');
 sjs2.src=stbl+"ctab.js";
document.head.appendChild(sjs2);
 ///
 function dropsett(){
  document.getElementById("setdrop").classList.toggle("show");
}
 ///

 function pagination(){
  idrow=true;
  const pageSize = 10;
$('#excelDataTable').html("");   
                 k=  l.filter((row, index) => {
    let start = (curPage-1)*pageSize;
    let end =curPage*pageSize;
    if(index >= start && index < end) return true;
});
buildHtmlTable(k); 
  if(fst==true){
    
return
}else{

  idrow=true;
  const pageSize = 10;
$('#excelDataTable').html("");   
                 k=  l.filter((row, index) => {
    let start = (curPage-1)*pageSize;
    let end =curPage*pageSize;
    if(index >= start && index < end) return true;
});
buildHtmlTable(k); 


nextPage.addEventListener("click", function () { 
if((curPage * pageSize) < l.length) curPage++;
k=  l.filter((row, index) => {
    let start = (curPage-1)*pageSize;
    let end =curPage*pageSize;
    if(index >= start && index < end) return true;
});

$('#excelDataTable').html("");
buildHtmlTable(k); 

},false);  
//
prevPage.addEventListener("click", function () { 
if(curPage > 1) curPage--;
k=  l.filter((row, index) => {
    let start = (curPage-1)*pageSize;
    let end =curPage*pageSize;
    if(index >= start && index < end) return true;
});

$('#excelDataTable').html("");
buildHtmlTable(k); 

},false); 
//   
}
}
//

 
//
function ru(){
 
    
 
  
$.ajax({
                  url: "sda.php",
             type: 'GET',
    cache: false,
                  beforeSend: function(xhr){
                    if (xhr.overrideMimeType)
                    {
                      xhr.overrideMimeType("application/json");
                    }
                  },
                  dataType: 'json',
                  data: null,
                  success:  function(data, textStatus, request) {
                    
                    l=mindata(data);
                    minid=minidx(data);
                        if (data== "[]" || (typeof data == "object" && data.length == 0)){
    l = null;
    $.ajax({
                  url: "header.json",
             type: 'GET',
    cache: false,
                  beforeSend: function(xhr){
                    if (xhr.overrideMimeType)
                    {
                      xhr.overrideMimeType("application/json");
                    }
                  },
                  dataType: 'json',
                  data: null,
                  success:  function(data, textStatus, request) {
              
                  
                       l=data;
            
             
                       foot=false;
            
                       buildHtmlTable(l); 
             
  
          
                  }
                });  
  }
            buildHtmlTable(l);
            //
            pagi.addEventListener('change', function() { 
               
              if(pagi.checked == true){
          pagination();
  //   
} 
else{
  
  fst=true;
  idrow=false;
  $('#excelDataTable').html("");
  buildHtmlTable(l); 

}
});
            
          
                  },error: function (request, status, error) {
        
          $.ajax({
                  url: "header.json",
             type: 'GET',
    cache: false,
                  beforeSend: function(xhr){
                    if (xhr.overrideMimeType)
                    {
                      xhr.overrideMimeType("application/json");
                    }
                  },
                  dataType: 'json',
                  data: null,
                  success:  function(data, textStatus, request) {
              
                  
                       l=data;
            
             
                     
            foot=false;
                       buildHtmlTable(l); 
            
          
                  }
                });   
        
        
    }
                }); 
                
              
            }
            var index ;
// Builds the HTML Table out of myList.


//
var obhgl={};
var obhglin={};
var minob={};
var obidar={};

var arhg={};
var formData=new FormData();
function buildHtmlTable(ll) {
 var selector = document.getElementById("excelDataTable");
  var columns = addAllColumnHeaders(ll, selector);
  
 

var tbod=$('<tbody/>');
var trs = document.querySelectorAll("tr");
var idx =0;
  for (var i = 0; i < ll.length; i++) {
    var row$ = $('<tr/>');
    
    if(scrolldiv==true){
    for (var colIndex = 0; colIndex < columns.length; colIndex++) {
      var dr=document.createElement('div');
      var cellValue = ll[i][columns[colIndex]];
      if (cellValue == null) cellValue = "";
      dr.append(cellValue);
      row$.append($('<td/>').html(dr));
      

    }
   
    $(selector).append(tbod.append(row$));
    $("table td").css("max-width", "100px");
  }
  if(cfit==true){
    for (var colIndex = 0; colIndex < columns.length; colIndex++) {
      var dr=document.createElement('div');
      var cellValue = ll[i][columns[colIndex]];
      if (cellValue == null) cellValue = "";
      dr.append(cellValue);
      row$.append($('<td/>').html(dr));
      

    }
   
    $(selector).append(tbod.append(row$));
    $("table td").css("word-break", "break-all");
    $("table td").css("max-width", "100px");
  }
  if(cfit==false && scrolldiv==false){
    for (var colIndex = 0; colIndex < columns.length; colIndex++) {
      var cellValue = ll[i][columns[colIndex]];
      if (cellValue == null) cellValue = "";
      row$.append($('<td/>').html(cellValue));
    }
    $(selector).append(tbod.append(row$));
  }
    var btndl=document.createElement("button");
  btndl.innerHTML="&#10005;";
  btndl.style.border="0px solid";
  btndl.className='btnetc';
  btndl.style.backgroundColor="rgba(190, 192, 191, 0.788)";
  btndl.id=ll.indexOf(ll[i]);
  btndl.title="Delete";
    btndl.addEventListener('click', () => { 
      var button = event.target;
      
  var indx = location.search.substring(1);
  var ids;
  if(idrow==true){
  if((curPage)>1){
    
    ids=(~~button.id+1)+((curPage-1)*10);
    formData.append('user5',JSON.stringify({nume:minid[~~button.id+((curPage-1)*10)]}));
  dltnum(formData,minid[~~button.id+((curPage-1)*10)]);
  formData =new FormData();

  
//   var dkey=Object.keys(obhglin);
//   for(s=0;s<dkey.length;s++){
//      if(~~dkey[s]>=(ids)){
//       if(~~dkey[s]==(ids)){
//       delete obhglin[dkey[s]];
     
//      }
//      else{
//       obhglin[~~dkey[s]-1] = obhglin[dkey[s]];   
//   delete obhglin[dkey[s]];
// }
//      }

//     }
//     minob[stbl]=obhglin;
var dkey=Object.keys(arhg);
    
   
    for(s=0;s<dkey.length;s++){
     
       if(~~dkey[s]>=(~~minid[~~button.id+((curPage-1)*10)])){
        if(~~dkey[s]==(~~minid[~~button.id+((curPage-1)*10)])){
         
             
     
     delete arhg[~~minid[~~button.id+((curPage-1)*10)]];
      
       }
       else{
        
         arhg[~~dkey[s]-1] = arhg[dkey[s]];   
   
    delete arhg[dkey[s]];
    
  }
       }
  
      }

    var dkey=Object.keys(obhgl);
  for(s=0;s<dkey.length;s++){
    if(~~dkey[s]>=(~~minid[~~button.id+((curPage-1)*10)]+1)){
      if(~~dkey[s]==(~~minid[~~button.id+((curPage-1)*10)]+1)){
      delete obhgl[dkey[s]];
     
     }
     else{
      obhgl[~~dkey[s]-1] = obhgl[dkey[s]];   
  delete obhgl[dkey[s]];
}
     }

    }
  

  formData.append('user3',JSON.stringify(obhgl));
        sendhgl(formData);
     formData= new FormData();
             formData.append('user4',JSON.stringify(arhg));
      sendhgl2(formData);
      formData=new FormData();

  }
  if(curPage==1){
    ids=~~button.id+1;
    formData.append('user5',JSON.stringify({nume:minid[button.id]}));
  dltnum(formData,minid[button.id]);
  formData =new FormData();

var dkey=Object.keys(arhg);
    
   
    for(s=0;s<dkey.length;s++){
     
       if(~~dkey[s]>=(~~minid[~~button.id])){
        if(~~dkey[s]==(~~minid[~~button.id])){
         
             
     
     delete arhg[minid[button.id]];
      
       }
       else{
        
         arhg[~~dkey[s]-1] = arhg[dkey[s]];   
   
    delete arhg[dkey[s]];
    
  }
       }
  
      }

    var dkey=Object.keys(obhgl);
  for(s=0;s<dkey.length;s++){
     if(~~dkey[s]>=(~~minid[~~button.id]+1)){
      if(~~dkey[s]==(~~minid[~~button.id]+1)){
      delete obhgl[dkey[s]];
     
     }
     else{
      obhgl[~~dkey[s]-1] = obhgl[dkey[s]];   
  delete obhgl[dkey[s]];
}
     }

    }


  formData.append('user3',JSON.stringify(obhgl));
        sendhgl(formData);
     formData= new FormData();
             formData.append('user4',JSON.stringify(arhg));
      sendhgl2(formData);
      formData=new FormData();
  }
}
else{

  ids=~~button.id+1;
  formData.append('user5',JSON.stringify({nume:minid[button.id]}));
  dltnum(formData,minid[button.id]);
  formData =new FormData();
 
    var dkeyo=Object.keys(obhgl);
    
    
  for(s=0;s<dkeyo.length;s++){
   
     if(~~dkeyo[s]>=(~~minid[~~button.id]+1)){
      if(~~dkeyo[s]==(~~minid[~~button.id]+1)){
       
      delete obhgl[dkeyo[s]];      
   
  
    
     }
     else{
      obhgl[~~dkeyo[s]-1] = obhgl[dkeyo[s]];   
  
  delete obhgl[dkeyo[s]];
 
  
}
     }

    }
    
    var dkey=Object.keys(arhg);
    
   
    for(s=0;s<dkey.length;s++){
     
       if(~~dkey[s]>=(~~minid[~~button.id])){
        if(~~dkey[s]==(~~minid[~~button.id])){
         
             
     
     delete arhg[minid[button.id]];
      
       }
       else{
        
         arhg[~~dkey[s]-1] = arhg[dkey[s]];   
   
    delete arhg[dkey[s]];
    
  }
       }
  
      }
    
//    
    
formData.append('user3',JSON.stringify(obhgl));
        sendhgl(formData);
     formData= new FormData();
             formData.append('user4',JSON.stringify(arhg));
      sendhgl2(formData);
      formData=new FormData();
 
}

  
  

  
   
    alert("Deleted");
  refresh();
    
   });
   var btned=document.createElement("button");
   btned.innerHTML="&#9999;";
   btned.id=ll.indexOf(ll[i]);
   btned.style.border="0px solid";
   btned.className='btnetc';
   btned.style.fontSize="larger";

btned.title="Edit";
  btned.style.backgroundColor="rgba(190, 192, 191, 0.788)";
   btned.addEventListener('click', () => { 
    var button = event.target;
    
    if(idrow==true){

if(curPage>1){
  
 window.location.href = 'edit.html?'+minid[~~button.id+((curPage-1)*10)]+'&onmintab';
 
}
if(curPage==1){
  window.location.href = 'edit.html?'+minid[~~button.id]+'&onmintab';
  
}
}
else{
window.location.href = 'edit.html?'+minid[~~button.id]+'&onmintab';


}
  });
   var btnpr=document.createElement("button");
   btnpr.innerHTML="&#10063;";
   btnpr.id=ll.indexOf(ll[i]);
   btnpr.className='btnetc';
   btnpr.style.border="0px solid";
   btnpr.title="Preview";
   btnpr.style.backgroundColor="rgba(190, 192, 191, 0.788)";
   btnpr.addEventListener('click', () => { 
      var button = event.target;
      if(idrow==true){
  if((curPage)>1){
     
    sessionStorage.setItem("idxpv",minid[~~button.id+((curPage-1)*10)]);
  }
  if(curPage==1){
    sessionStorage.setItem("idxpv",minid[~~button.id]);
  }
}
else{
  sessionStorage.setItem("idxpv",minid[~~button.id]); 
}
     
      
        window.location.href = "/pagevw.html?onmintab";
  });
   var btnmrk=document.createElement("button");
   btnmrk.innerHTML="&#10002;";
   
   btnmrk.id=ll.indexOf(ll[i]);
   btnmrk.className='btnetc';
   btnmrk.style.border="0px solid";
   btnmrk.title="Mark";
   btnmrk.style.fontSize="large";
   btnmrk.style.backgroundColor="rgba(190, 192, 191, 0.788)";
   btnmrk.addEventListener('click', () => { 
      var button = event.target;
      var x = document.getElementById("excelDataTable").getElementsByTagName("tbody")[0].getElementsByTagName('tr');
      var ids=~~button.id+1;
    
        x[ids-1].id="x"+ids;
        var dkey=Object.keys(ll[0]);
var dval=Object.values(dkey[0]);
      document.getElementById("x"+ids).style.backgroundColor = hglcolor.value ;
      //let result = ll[ids-1][dkey[0]];
      
      
        
     
    
        if(hglins.checked==true){
          var idmin;
          if(idrow==true){
  if((curPage)>1){
    
    // obhglin[ids+((curPage-1)*10)]=hglcolor.value;
    // idmin=minid[~~button.id+((curPage-1)*10)]+1;
    // obidar[idmin]=ids+((curPage-1)*10);
    if(arhg[minid[~~button.id+((curPage-1)*10)]]){
    var minohg={};
   minohg=arhg[minid[~~button.id+((curPage-1)*10)]]
  minohg[stbl]=hglcolor.value;
    arhg[minid[~~button.id+((curPage-1)*10)]]=minohg;
  }
  else{
  var minohg={};
  minohg[stbl]=hglcolor.value;
  arhg[minid[~~button.id+((curPage-1)*10)]]=minohg;
}
  }
  if(curPage==1){
    // obhglin[ids]=hglcolor.value; 
    // idmin=~~minid[~~button.id]+1;
    // obidar[idmin]=ids;
    if(arhg[minid[~~button.id]]){
    var minohg={};
   minohg=arhg[minid[~~button.id]]
  minohg[stbl]=hglcolor.value;
    arhg[minid[~~button.id]]=minohg;
  }
  else{
  var minohg={};
  minohg[stbl]=hglcolor.value;
  arhg[minid[~~button.id]]=minohg;
}
  }
}
else{
  if(arhg[minid[~~button.id]]){
    var minohg={};
   minohg=arhg[minid[~~button.id]]
  minohg[stbl]=hglcolor.value;
    arhg[minid[~~button.id]]=minohg;
  }
  else{

  
  var ohg={};
  var minohg={};
  
  minohg[stbl]=hglcolor.value;
  arhg[minid[~~button.id]]=minohg;

}
  

  // obhglin[ids]=hglcolor.value;
  // idmin=~~minid[~~button.id]+1;
  // obidar[idmin]=ids;
}
// if(minob[stbl]){
//   minob[stbl][0]=obidar;
// minob[stbl][1]=obhglin;
// }
// else{
//   var pp=[obidar,obhglin];
//   minob[stbl]=pp;
// }

// alert(JSON.stringify(arhg));
// alert(JSON.stringify(minid.indexOf(minid[~~button.id])));

       
          formData.append('user4',JSON.stringify(arhg));
      sendhgl2(formData);
      formData=new FormData();
          
        
        }
        else{
          if(idrow==true){
  if((curPage)>1){
    
    obhgl[minid[~~button.id+((curPage-1)*10)]+1]=hglcolor.value;
    
  }
  if(curPage==1){
    obhgl[~~minid[~~button.id]+1]=hglcolor.value; 
  }
}
else{
  obhgl[~~minid[~~button.id]+1]=hglcolor.value;
}
formData.append('user3',JSON.stringify(obhgl));
        sendhgl(formData);
     formData= new FormData();
   
      }
    
  
   });
   var cucol=document.createElement('button');
   cucol.innerHTML=" &#10001;";
   cucol.id=ll.indexOf(ll[i]);
   cucol.className='btnetc';
   cucol.style.fontSize="large";
   cucol.style.border="0px solid";
  cucol.value="#f3f3f3"
  cucol.title="Unmark";

   cucol.style.backgroundColor="rgba(190, 192, 191, 0.788)";
   cucol.addEventListener('click', () => { 
    var button = event.target;
      var x = document.getElementById("excelDataTable").getElementsByTagName("tbody")[0].getElementsByTagName('tr');

      var ids=~~button.id+1;
      
    if(hglins.checked==true){
//       var dkey=Object.keys(obhglin);
// var dval=Object.values(dkey[0]);
      x[~~button.id].style.backgroundColor = getComputedStyle(document.documentElement)
    .getPropertyValue('--bgc'); 
//     let result = ll[ids-1][dkey[0]];
    if(idrow==true){
  if((curPage)>1){
    // delete obhglin[ids+((curPage-1)*10)]; 
    // idmin=minid[~~button.id+((curPage-1)*10)]+1;
    // delete obidar[idmin]; 
    
    if(arhg[minid[~~button.id+((curPage-1)*10)]]){
      delete arhg[minid[~~button.id+((curPage-1)*10)]][stbl];
      if(Object.values(arhg[minid[~~button.id+((curPage-1)*10)]]).length==0){
      delete arhg[minid[~~button.id+((curPage-1)*10)]];  
      }
      
    }
  }
  if(curPage==1){
    // delete obhglin[ids];  
    // idmin=minid[button.id]+1;
    // delete obidar[idmin]; 
    if(arhg[minid[button.id]]){
      delete arhg[minid[button.id]][stbl];
      if(Object.values(arhg[minid[button.id]]).length==0){
      delete arhg[minid[button.id]];  
      }
    }
  }
}
else{
  // delete obhglin[ids];  
  // idmin=minid[button.id]+1;
  //   delete obidar[idmin]; 
    if(arhg[minid[button.id]]){
      delete arhg[minid[button.id]][stbl];
      if(Object.values(arhg[minid[button.id]]).length==0){
      delete arhg[minid[button.id]];  
      }
    }
}

  formData.append('user4',JSON.stringify(arhg));
      sendhgl2(formData);
      formData=new FormData();

    }
    else{
      var dkey=Object.keys(obhgl);
var dval=Object.values(dkey[0]);

      x[~~button.id].style.backgroundColor = getComputedStyle(document.documentElement)
    .getPropertyValue('--bgc'); 
    // let result = ll[minid[button.id]][dkey[0]];
    
    if(idrow==true){
  if((curPage)>1){
    delete obhgl[minid[~~button.id+((curPage-1)*10)]+1];  
  }
  if(curPage==1){
    delete obhgl[minid[button.id]+1];  
  }
}
else{
  delete obhgl[minid[button.id]+1];  
}
formData.append('user3',JSON.stringify(obhgl));
        sendhgl(formData);
     formData= new FormData();
     
    }
    
   });
   var dl=document.createElement('div');
   dl.className='divetc';
   dl.appendChild(btndl);
   dl.appendChild(btned);
   dl.appendChild(btnpr);
   dl.appendChild(btnmrk);
   dl.appendChild(cucol);

   var ind=~~ll.indexOf(ll[i])+1;
    row$.append($('<td/>').html(dl));
    
    $(selector).append(tbod.append(row$));
    
    
 idx++

  }
  
    if(foot==true){
    var fn = window['cr_foot']; 
if(typeof fn === 'function') {
  cr_foot(ll);
}
}
  var dd=[];
 
  

  const secondKey = Object.keys(ll[0]);
 
for (var i = 0; i < trs.length; i++){
 
  (function (e) {
    trs[e].addEventListener("click", function () {
     
     
      index = $(this).closest('tr').index();
    }, false);
  })(i);}
  markhgl();
  markhgl2();
}

// Adds a header row to the table and returns the set of columns.
// Need to do union of keys from all records as some records may not contain
// all records.
function addAllColumnHeaders(myList, selector) {
  var columnSet = [];
  var headerTr$ = $('<tr/>');
 var theads=$('<thead/>');

  for (var i = 0; i < myList.length; i++) {
    var rowHash = myList[i];
    for (var key in rowHash) {
      if ($.inArray(key, columnSet) == -1) {
        columnSet.push(key);
        
        headerTr$.append($('<th/>').html(key));
        
      }
    }
  }
  headerTr$.append($('<th/>').html("Edit"));
 
  $(selector).append(theads.append(headerTr$));

  return columnSet;
}



function divover(){
  document.getElementById("setfr").hidden=true;
  document.getElementById("setcl").hidden=false;
  document.getElementById("refresh").hidden=false;
  document.getElementById("slid").hidden=false;
  document.getElementById("slid1").hidden=false;
  document.getElementById("slid2").hidden=false;
  document.getElementById("setting").hidden=false;
  document.getElementById("search").hidden=false;
  document.getElementById("searcttxt").hidden=false;
  document.getElementById("hglcolor").hidden=false;
  document.getElementById("set").style.height="30px";
  document.getElementById("set").style.backgroundColor="rgba(148, 158, 151, 0.767)";
  document.getElementById("setting").style.display="flex";
  document.getElementById("search").style.display="flex";
  document.getElementById("refresh").style.display="flex";
  document.getElementById("slid").style.display="inline-block";
  document.getElementById('drpbtn').hidden=false;
  document.getElementById('drpbtn').style.display="flex";
 
}
function divout(){
  document.getElementById("refresh").hidden=true;
  document.getElementById("setting").hidden=true;
  document.getElementById('drpbtn').hidden=true;
  document.getElementById("search").hidden=true;
  document.getElementById("searcttxt").hidden=true;
  document.getElementById("slid").hidden=true;
  document.getElementById("slid1").hidden=true;
  document.getElementById("slid2").hidden=true;
  document.getElementById("setfr").hidden=false;
  document.getElementById("setcl").hidden=true;
  document.getElementById("hglcolor").hidden=true;
  document.getElementById("set").style.height="10px";
  document.getElementById("set").style.backgroundColor="transparent";
  document.getElementById("setting").style.display="none";
  document.getElementById("search").style.display="none";
  document.getElementById("refresh").style.display="none";
  document.getElementById("slid").style.display="none";
  document.getElementById('drpbtn').style.display="none";
} 
function refresh(){
  cwb.checked =false;scrc.checked =false;
  if(pagi.checked==true){fst=true;}
  pagi.checked=false;
  location.reload(); 
} 
window.addEventListener("click", function(event) {
  
  if (!event.target.matches('.dropseting')) {
    var dropdowns = document.getElementsByClassName("dropset");
    var i;
    for (i = 0; i < dropdowns.length; i++) {
      var openDropdown = dropdowns[i];
      if (openDropdown.classList.contains('show')) {
        openDropdown.classList.remove('show');
      }
    }
  }

});
function src(){
  idrow=false;
  fst=true;
  $('#excelDataTable').html("");
  buildHtmlTable(l); 
  
}
function srefc(){
  $('#excelDataTable').html("");
  buildHtmlTable(l); 
}
function srchout(input) {
  // Declare variables
  var  filter, table, tr, td, i, txtValue;
  
  filter = input.value.toUpperCase();
  if(pagi.checked==true){
    if(filter==""){
      pagination();
    }
    else{
src();
table = document.getElementById("excelDataTable");
tr = table.getElementsByTagName("tr");

  // Loop through all table rows, and hide those who don't match the search query
  for (i = 0; i < tr.length; i++) {
    tds = tr[i].getElementsByTagName("td")
    var foundInRow = false
    for(j=0; j<tds.length; j++){
    if(foundInRow)
        continue
    td = tr[i].getElementsByTagName("td")[j];
    if (td) {
      txtValue = td.textContent || td.innerText;
      if (txtValue.toUpperCase().indexOf(filter) > -1) {
        foundInRow = true
        tr[i].style.display = "";
      } else {
        tr[i].style.display = "none";
      }
    }      
    }
  }
}
  }
  else{
    table = document.getElementById("excelDataTable");
    tr = table.getElementsByTagName("tr");

  // Loop through all table rows, and hide those who don't match the search query
  for (i = 0; i < tr.length; i++) {
    tds = tr[i].getElementsByTagName("td")
    var foundInRow = false
    for(j=0; j<tds.length; j++){
    if(foundInRow)
        continue
    td = tr[i].getElementsByTagName("td")[j];
    if (td) {
      txtValue = td.textContent || td.innerText;
      if (txtValue.toUpperCase().indexOf(filter) > -1) {
        foundInRow = true
        tr[i].style.display = "";
      } else {
        tr[i].style.display = "none";
      }
    }      
    }
  }

  }
  
} 
function tablesrch() {
  // Declare variables
  var input, filter, table, tr, td, i, txtValue;
  input = document.getElementById("searcttxt");
  filter = input.value.toUpperCase();
  if(pagi.checked==true){
    if(filter==""){
      pagination();
    }
    else{
src();
table = document.getElementById("excelDataTable");
  tr = table.getElementsByTagName("tr");

  // Loop through all table rows, and hide those who don't match the search query
  for (i = 0; i < tr.length; i++) {
    tds = tr[i].getElementsByTagName("td")
    var foundInRow = false
    for(j=0; j<tds.length; j++){
    if(foundInRow)
        continue
    td = tr[i].getElementsByTagName("td")[j];
    if (td) {
      txtValue = td.textContent || td.innerText;
      if (txtValue.toUpperCase().indexOf(filter) > -1) {
        foundInRow = true
        tr[i].style.display = "";
      } else {
        tr[i].style.display = "none";
      }
    }      
    }
  }
    }
  }
  else{
    table = document.getElementById("excelDataTable");
  tr = table.getElementsByTagName("tr");

  // Loop through all table rows, and hide those who don't match the search query
  for (i = 0; i < tr.length; i++) {
    tds = tr[i].getElementsByTagName("td")
    var foundInRow = false
    for(j=0; j<tds.length; j++){
    if(foundInRow)
        continue
    td = tr[i].getElementsByTagName("td")[j];
    if (td) {
      txtValue = td.textContent || td.innerText;
      if (txtValue.toUpperCase().indexOf(filter) > -1) {
        foundInRow = true
        tr[i].style.display = "";
      } else {
        tr[i].style.display = "none";
      }
    }      
    }
  }
  }
}   

function getallcss() {
  var css= [];

for (var sheeti= 0; sheeti<document.styleSheets.length; sheeti++) {
    var sheet= document.styleSheets[sheeti];
    var rules= ('cssRules' in sheet)? sheet.cssRules : sheet.rules;
    for (var rulei= 0; rulei<rules.length; rulei++) {
        var rule= rules[rulei];
        if ('cssText' in rule)
            css.push(rule.cssText);
        else
            css.push(rule.selectorText+' {\n'+rule.style.cssText+'\n}\n');
    }
}

return css.join('\n');
}
function sendhgl(data){
  $.ajax({
url: 'onhg.php',
type: 'post',
data: data,
processData: false,
contentType: false,
success: function(response){

  

  markhgl();
   markhgl2();
  

}});
}

function markhgl(){
  $.ajax({
                  url: "lmhgl.php",
             type: 'GET',
    cache: false,
                  beforeSend: function(xhr){
                    if (xhr.overrideMimeType)
                    {
                      xhr.overrideMimeType("application/json");
                    }
                  },
                  dataType: 'json',
                  data: null,
                  success:  function(data, textStatus, request) {
              
                  
                      var hgl=data;
                       obhgl=hgl;
                       var hjs="";
                       var horg="";
                       var dkey=Object.keys(hgl);
        for(var s=0;s<dkey.length;s++){
         for(var p=0;p<minid.length;p++){
          if(~~dkey[s]==~~minid[p]+1){
          hjs=p+1;
          console.log(dkey[s]+" "+minid[p]) 
          var x = document.getElementById("excelDataTable").getElementsByTagName("tbody")[0].getElementsByTagName('tr');
 if(idrow==true){
 
 
 if(x.length<12){
 if((~~hjs)<=(curPage)*10 &&(~~hjs)>(curPage-1)*10 ){
 var newnum= (~~hjs)-((curPage-1)*10);
 
 
 if(newnum<=x.length){
 x[newnum-1].style.backgroundColor = hgl[minid[p]+1] ;
 }
 }
 if((curPage)*10<11){
 var newnum= (~~hjs);
 
 
 if(newnum<=x.length){
 x[newnum-1].style.backgroundColor = hgl[minid[p]+1] ;
 }
 }
 }
 
 }else{
 
 
 x[~~hjs-1].style.backgroundColor = hgl[minid[p]+1] ;
 
 }
        }
         }
         
 
 
        
        } 
                  }
                });  
}
function sendhgl2(data){
  
  $.ajax({
url: 'onhg.php',
type: 'post',
data: data,
processData: false,
contentType: false,
success: function(response){  
  
 
   markhgl();
   markhgl2();
  

}});
}

function markhgl2(){
  $.ajax({
                  url: "lhgl.php",
             type: 'GET',
    cache: false,
                  beforeSend: function(xhr){
                    if (xhr.overrideMimeType)
                    {
                      xhr.overrideMimeType("application/json");
                    }
                  },
                  dataType: 'json',
                  data: null,
                  success:  function(data, textStatus, request) {
              
                    var x = document.getElementById("excelDataTable").getElementsByTagName("tbody")[0].getElementsByTagName('tr');
                       arhg=data;
                    //  alert(JSON.stringify(arhg))  ;
                       var hglin;
                       var dkey=Object.keys(arhg);
        for(var s=0;s<dkey.length;s++){
        
        if(arhg[dkey[s]][stbl]){
          // alert(minid.indexOf(~~dkey[s]));
          
          if(idrow==true){
if(x.length<12){
  var hjs=minid.indexOf(~~dkey[s]);
if((~~hjs)<(curPage)*10 &&(~~hjs)>=(curPage-1)*10 ){
var newnum= (~~hjs)-((curPage-1)*10);


if(newnum<x.length){
x[newnum].style.backgroundColor = arhg[dkey[s]][stbl] ;
}
}
if((curPage)*10<11){
var newnum= (~~hjs);


if(newnum<x.length){
  x[minid.indexOf(~~dkey[s])].style.backgroundColor = arhg[dkey[s]][stbl] ;
}
}
}


}else{

  
x[minid.indexOf(~~dkey[s])].style.backgroundColor = arhg[dkey[s]][stbl] ;

}
        }

        }
                }
                });  
}
function closeset(){
  fetch('http://localhost:3000/close', {
    method: 'POST',
body: "",
headers: { 'Content-Type': 'application/json' }
})
}
window.onerror = function(error, url, line) {
    //alert(error+' URL:'+url+' L:'+line);  
};
</script>
        <table id="excelDataTable" class="styled-table" >
          
          <tfoot id="tfot">
        
          </tfoot>
  </table>
</body>
</html>
